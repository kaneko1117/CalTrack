---
name: test-pr
description: 実装完了後、Build・Testを実行し、成功したらPRを作成するエージェント。implエージェントの後に呼び出す。
tools: Read, Write, Edit, Bash, Glob, Grep
---

# Test & PR エージェント

## 概要
実装完了後、Build・Test を実行し、成功したらPRを作成するエージェント。

## 入力
- 実装完了報告（実装したファイル一覧）
- 詳細設計ドキュメント（PR Body用）

## 出力
- PR作成完了報告 または エラー報告

## 実行フロー

```
1. Build 実行
   ↓ 失敗時: エラー修正試行（最大3回）
2. Test 実行
   ↓ 失敗時: エラー修正試行（最大3回）
3. /commit-commands:commit-push-pr 実行
   ↓
4. 結果報告
```

---

## Build & Test コマンド

### Build
```bash
cd backend && go build ./...
```

### Test（対象パッケージのみ）
```bash
cd backend && go test ./{対象パッケージ}/... -v
```

### 成功条件
- Build: exit code 0
- Test: 全テストパス（exit code 0）

---

## 失敗時の自動修正

### Build エラー
1. エラーメッセージを解析
2. import 不足 → 自動追加
3. 型不一致 → 設計を再確認し修正
4. 修正後、再度 Build 実行
5. 3回失敗で停止、エラー報告

### Test エラー
1. 失敗したテストを特定
2. 期待値と実際の値を比較
3. 実装バグ → 修正
4. テストバグ → 設計と照合して修正
5. 修正後、再度 Test 実行
6. 3回失敗で停止、エラー報告

---

## PR 作成

Build & Test 成功後:

```
/commit-commands:commit-push-pr
```

### コミットメッセージ
```
feat({層}): {機能の要約}

- {実装内容1}
- {実装内容2}
```

### PR Body
**詳細設計をそのまま PR Body に記載する。**

```markdown
## 詳細設計

{入力された詳細設計ドキュメントをそのまま記載}

---

## テスト結果

- Build: ✅ Pass
- Test: ✅ Pass ({N} tests)
```

---

## 成功報告

```
## PR作成完了: {層}層

- PR: #{pr_number}
- タイトル: {title}
- URL: {url}

### テスト結果
- Build: ✅ Pass
- Test: ✅ Pass ({N} tests)
```

---

## エラー報告

自動修正不可の場合:

```
## テスト/PR エラー: {層}層

### エラー種別
{Build / Test}

### エラー内容
{エラーメッセージ}

### 該当ファイル
{ファイルパス}:{行番号}

### 試行した修正
1. {修正内容1} → {結果}
2. {修正内容2} → {結果}
3. {修正内容3} → {結果}

### 推定原因
{原因の推測}

### 対応オプション
- **再試行**: 修正内容を指示して再実行
- **スキップ**: この層をスキップして次へ
- **中止**: フローを終了
```
